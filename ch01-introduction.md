# 1章 イントロダクション

## 1.1　システムパフォーマンス

- フルスタック（full stack）という用語は、システムパフォーマンスがテーマになっているときには、システムライブラリ、カーネル、ハードウェア自体を含むアプリケーションからメタル（ハードウェア）までのすべてという意味になる。システムパフォーマンスの研究対象はフルスタックだ。
- コンパイラはシステムパフォーマンスに影響を与える。

## 1.2　職種

- システムパフォーマンスに関わる職種はさまざまあり、それぞれの肩書きの人にとっては、パフォーマンス関連の仕事は職務全体のごく一部だ。
- パフォーマンス向上が主要業務であるパフォーマンスエンジニアという職業を配置する企業もある。彼らは複数のチームと協力して環境をホリスティック（全体的）な視野から検討する。複雑なパフォーマンス障害を解決するためには、このようなアプローチが必要不可欠だ。
  
## 1.3　作業

- 本番ワークロードの一部を1台のサーバーインスタンスで実行される新ソフトウェアで処理して新ソフトウェアをテストするテクニックがある。これをカナリアテスト（canary testing）と呼ぶ。
- バックアップとしてもとのプールをオンラインに残しながら、トラフィックを少しずつ新しいサーバーインスタンスのプールに移していくもので、ブルー・グリーンデプロイメント（blue-greendeployment）と呼ぶ。そのようなフェイルセーフな方法を導入すると、あらかじめパフォーマンス分析
をすることなく新ソフトウェアを本番環境でテストすることが多い。
  - 👩‍💻 カナリアやB/Gデプロイメントの難しさ。どこまでテストするのか？判断基準が難しい。
- 設計中のキャパシティプランニング（capacity planning）には、開発しようとしているソフトウェアのリソースフットプリントの検討や設計がニーズの目標にどれだけ応えられるかの予測などが含まれる。デプロイ後は、リソースの使用状況のモニタリングや、予防的に問題を予測することが含まれる。
  
## 1.4　分析の視点
- __リソース分析(resource analysis)__ の視点は、一般にシステムリソースを担当するシステム管理者が取るもので、 ワークロード処理パフォーマンスに責任を負うアプリケーション開発者は、一般に __ワークロード分析(workload analysis)__ の視点を取る。
## 1.5　パフォーマンスエンジニアリングの難しさと面白さ
### 1.5.1　主観的な性質
- テクノロジの分野は客観的になるのが普通
- パフォーマンスは主観的な問題になることが多い。パフォーマンス障害は、そもそもそれが問題なのかどうかがはっきりせず、問題だとしてもそれが修復されたかどうかがまたはっきりしない。ひとりのユーザーがパフォーマンスが「悪い」、問題だと思っても、別のユーザーはパフォーマンスが「いい」と思う
ことがある。
### 1.5.2　複雑さ
- パフォーマンスエンジニアリングは、主観的だということに加え、システムが複雑で分析の自明な出発点がないことによっても難しくなっている。
- 結果として起きている問題を理解するためには、コンポーネントの間の込み入った関係を解きほぐし、それらがどのように問題に関わっているかを理解しなければならない。
- 複雑なパフォーマンス障害の解決には、ホリスティックなアプローチが必要になることが多い
### 1.5.3　複数の原因の相互作用
- パフォーマンス障害のなかには、根本原因がひとつだけではなく、複数の要因によって起きているものがある
### 1.5.4　複数のパフォーマンス障害の同時発生
- 本当の仕事は問題を見つけることではなく、問題の本質を見極めること、あるいはもっとも重大な意味を持つ問題を見つけることなのだ。
- パフォーマンスアナリストには問題の大きさを定量化（quantify）することが求められる。
- ただ問題の大きさを測るだけではなく、個々の問題を解決したときに得られるはずのスピードアップの度合いも推定したい。この情報は、経営陣がエンジニアリングや運用の資源を使う理由を探しているときに大きな価値を持つ場合がある。
## 1.6　レイテンシ
- レイテンシは、待つために使った時間を計測したもので、必要不可欠なパフォーマンス指標である。
- レイテンシも修飾語で条件を明確にしなければ曖昧になることがある。たとえば、ネットワーキングでは、レイテンシは、データ転送時間ではなく接続が開設されるまでの時間という意味になることも、データ転送を含む接続時間全体という意味になることもある
## 1.7　可観測性
- 可観測性とは観察によってシステムを理解することであり、そのためのツールを可観測性ツールと呼ぶ。
### 1.7.1　カウンタ、統計量、指標
- アプリケーションやカーネルは、それぞれの状態とアクティビティについてのデータを提供する。オペレーション数、バイト数、レイテンシの計測値、リソースの使用状況、エラー率などである。これらのデータは、一般にソフトウェアにハードコードされたカウンタ（counter）と呼ばれる整数変数に格納される。
- 指標（metric）は対象を評価または監視するために選ばれた統計量である
### 1.7.2　プロファイリング
- システムパフォーマンスの分野では、プロファイリング（profiling）とは、サンプリングツールの使用という意味である。計測値のサブセット（サンプル）を取り、対象のおおよその姿を描くのである。
### 1.7.3　トレーシング
- トレーシングはイベントベースの記録で、イベントの関連データをキャプチャしてあとで分析するために保存したり、カスタムサマリーの作成などの処理のためにその場で消費したりする。
### 1.7.3.2 動的インストルメンテーション
- 動的インストルメンテーションは、ソフトウェア起動後、メモリ内の命令を書き換えてインストルメン
テーションルーチンを挿入するという方法でインストルメンテーションポイントを作る。
### 1.7.3.3 BPF
- Linux 用の最新の動的トレーシングツールは、BPF（もともとはBerkeley Packet Filter の略）をベースとしている。
## 1.8　実験
- 可観測性ツールのほかに実験（experimentation）ツールもあるが、その大半はベンチマーキングツールである。
- ベンチマーキングツールには、クライアントがアプリケーションに要求を発行するなどのリアルなワークロードをシミュレートするマクロベンチマーク（macro-benchmark）ツールと、CPU、ディスク、ネットワークなどの特定のコンポーネントをテストするマイクロベンチマーク（micro-benchmark）ツールがある
- 本番システムではまず可観測性ツールを試すべきだ
## 1.9　クラウドコンピューティング
- クラウドコンピューティングは、オンデマンドで計算資源をデプロイする手段である。
- クラウドコンピューティングと仮想化は、新しい問題も生み出している。ほかのテナントからの影響でパフォーマンスが下がらないようにしなければならないし（パフォーマンス隔離: performanceisolation と呼ばれることがある）、各テナントから物理システムを観察できない場合がある
## 1.10　メソドロジ
- メソドロジ（方法論）とは、システムパフォーマンスに関連するさまざまな作業を実行するための推奨手順を文書化したものである。
### 1.10.1　60秒で終わるLinuxパフォーマンス分析
## 1.11　ケーススタディ
### 1.11.1　ディスクの速度低下
- まずしなければならないことは、問題を詳しく調べ、細部についての情報を集めて問題記述（problem statement）を作ることだ。
- USEメソッド
  - Utilization: 使用率
  - Saturation: 飽和率
  - Errors: エラー数
### 1.11.2　ソフトウェア変更
- 限界に達するまでクライアントシミュレータからの負荷を上げていくのである（これはストレステスト: stress testing と呼ばれることがある）。
### 1.11.3　より深く学ぶために
## 1.12　参考文献
